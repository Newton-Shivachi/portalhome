{% extends "base.html" %}
{% block content %}

<div class="flex flex-col items-center justify-center px-4 py-6 min-h-screen bg-gray-100">
    <!-- House Title -->
    <h2 class="text-4xl md:text-5xl font-bold text-gray-900 text-center mt-4">{{ house.name }}</h2>

    <!-- Description Section -->
    <div class="bg-white shadow-lg rounded-lg p-6 mt-4 w-full max-w-4xl text-center">
        <p class="text-gray-700 text-lg leading-relaxed">{{ house.description }}</p>
        
        <!-- Rental Price -->
        <p class="text-2xl font-semibold text-blue-600 mt-4">
            Rent: <span class="text-gray-800">{{ house.rent }}</span>
        </p>
    </div>

    <!-- Image Carousel -->
    {% if images %}
    <div class="image-carousel mt-8 flex flex-col items-center w-full">
        <div class="relative w-full max-w-xs sm:max-w-md md:max-w-3xl">
            <img id="house-img"
                 src="{{ images.0.image.url|add:'?f_auto,q_auto,w_1000' }}" 
                 alt="House Image"
                 class="w-full h-[280px] sm:h-[400px] md:h-[500px] object-cover rounded-lg shadow-lg transition-all duration-300 ease-in-out">

            <!-- Navigation Buttons (Now Positioned Outside) -->
            <div class="flex justify-between w-full mt-4">
                <button onclick="prevImage()" 
                        class="bg-gray-800 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition">
                    ◀ Previous
                </button>
                <button onclick="nextImage()" 
                        class="bg-gray-800 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition">
                    Next ▶
                </button>
            </div>
        </div>

        <script>
            let images = [
                {% for img in images %}
                    "{{ img.image.url|add:'?f_auto,q_auto,w_1000' }}",
                {% endfor %}
            ];
            let index = 0;

            function nextImage() {
                index = (index + 1) % images.length;
                document.getElementById("house-img").src = images[index];
            }

            function prevImage() {
                index = (index - 1 + images.length) % images.length;
                document.getElementById("house-img").src = images[index];
            }

            // Swipe functionality for mobile users
            let touchStartX = 0;
            let touchEndX = 0;
            const carousel = document.getElementById("house-img");

            carousel.addEventListener("touchstart", function(event) {
                touchStartX = event.touches[0].clientX;
            });

            carousel.addEventListener("touchend", function(event) {
                touchEndX = event.changedTouches[0].clientX;
                handleSwipe();
            });

            function handleSwipe() {
                let swipeDistance = touchStartX - touchEndX;
                if (swipeDistance > 50) {
                    nextImage(); // Swipe Left
                } else if (swipeDistance < -50) {
                    prevImage(); // Swipe Right
                }
            }
        </script>
    </div>
    {% else %}
    <p class="text-gray-500 italic mt-4 text-center">No images available.</p>
    {% endif %}

    <!-- Video Section -->
    {% if house.video %}
    <div class="mt-10 flex flex-col items-center w-full">
        <h4 class="text-2xl md:text-3xl font-semibold text-gray-900">House Video</h4>
        <video class="w-full sm:w-[500px] md:w-[700px] md:h-[400px] rounded-lg shadow-lg mt-4" 
               controls 
               autoplay 
               muted 
               playsinline>
            <source src="{{ house.video.url|add:'?f_auto,q_auto' }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
    {% endif %}

    <!-- View Details Button -->
    <a href="{% url 'house_detail' house.id %}" 
       class="mt-10 inline-block bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 text-lg font-semibold shadow-md transition">
        View More Details
    </a>
</div>

{% endblock %}
